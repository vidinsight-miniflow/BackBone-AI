"""
{{ model.description or model.class_name + ' model.' }}
"""
{% if imports %}
{% for import_stmt in imports %}
{{ import_stmt }}
{% endfor %}
{% endif %}


class {{ model.class_name }}{{ model.inheritance_chain }}:
    """{{ model.description or model.class_name + ' model.' }}"""

    __tablename__ = "{{ model.table_name }}"
{% if columns %}

    # Columns
{% for column in columns %}
    {{ column.name }} = Column(
{%- if column.type == "ForeignKey" %}
        Integer,
        ForeignKey("{{ column.kwargs.foreign_key }}"{% if column.kwargs.on_delete %}, ondelete="{{ column.kwargs.on_delete }}"{% endif %}),
{%- elif column.type == "Enum" %}
        Enum(
            {%- for val in column.args[:-1] %}
"{{ val }}", {% endfor %}
            name="{{ column.args[-1] }}"
        ),
{%- elif column.type == "String" %}
        String({{ column.args[0] if column.args else 255 }}),
{%- elif column.type == "Numeric" %}
        Numeric({% if column.args %}{{ column.args|join(', ') }}{% endif %}),
{%- else %}
        {{ column.type }}{% if column.args %}({{ column.args|join(', ') }}){% endif %},
{%- endif %}
{%- for key, value in column.kwargs.items() %}
{%- if key not in ['foreign_key', 'on_delete'] %}
        {{ key }}={{ value|tojson }},
{%- endif %}
{%- endfor %}
    ){% if column.comment %}  # {{ column.comment }}{% endif %}
{% endfor %}
{% endif %}
{% if relationships %}

    # Relationships
{% for rel in relationships %}
    {{ rel.name }} = relationship(
        "{{ rel.target_class }}",
        back_populates="{{ rel.back_populates }}",
{%- if rel.kwargs %}
{%- for key, value in rel.kwargs.items() %}
        {{ key }}={{ value|tojson }},
{%- endfor %}
{%- endif %}
    )
{% endfor %}
{% endif %}

    def __repr__(self) -> str:
        """String representation of {{ model.class_name }}."""
{%- if columns %}
{%- set pk_columns = columns|selectattr('kwargs.primary_key', 'equalto', true)|list %}
{%- if pk_columns %}
        return f"<{{ model.class_name }}({% for pk in pk_columns %}{{ pk.name }}={self.{{ pk.name }}}{% if not loop.last %}, {% endif %}{% endfor %})>"
{%- else %}
        return f"<{{ model.class_name }}()>"
{%- endif %}
{%- else %}
        return f"<{{ model.class_name }}()>"
{%- endif %}
