"""
Database mixins for common patterns.

This module provides reusable mixins for common database patterns
such as timestamps and soft deletes.
"""

from datetime import datetime

from sqlalchemy import Boolean, Column, DateTime


class TimestampMixin:
    """
    Mixin that adds timestamp fields to a model.

    Attributes:
        created_at: Timestamp when the record was created
        updated_at: Timestamp when the record was last updated
    """

    created_at = Column(
        DateTime,
        default=datetime.utcnow,
        nullable=False,
    )
    updated_at = Column(
        DateTime,
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
    )


class SoftDeleteMixin:
    """
    Mixin that adds soft delete functionality to a model.

    Instead of physically deleting records, this mixin marks them
    as deleted and records when the deletion occurred.

    Attributes:
        is_deleted: Flag indicating if the record is deleted
        deleted_at: Timestamp when the record was deleted
    """

    is_deleted = Column(
        Boolean,
        default=False,
        nullable=False,
        index=True,
    )
    deleted_at = Column(
        DateTime,
        nullable=True,
    )

    def soft_delete(self) -> None:
        """Mark this record as deleted."""
        self.is_deleted = True
        self.deleted_at = datetime.utcnow()

    def restore(self) -> None:
        """Restore a soft-deleted record."""
        self.is_deleted = False
        self.deleted_at = None
